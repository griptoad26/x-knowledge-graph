<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X Knowledge Graph V0.3.17</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #1a1a2e; color: #eee; height: 100vh; overflow: hidden; }
        .container { display: grid; grid-template-columns: 320px 1fr 320px; grid-template-rows: 1fr 60px; height: 100vh; gap: 1px; background: #16213e; }
        .panel { background: #1a1a2e; padding: 15px; overflow: auto; }
        .panel-header { font-size: 13px; font-weight: 600; color: #00d9ff; margin-bottom: 12px; padding-bottom: 10px; border-bottom: 1px solid #16213e; text-transform: uppercase; letter-spacing: 1px; }
        .btn { padding: 10px 16px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; transition: all 0.2s; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: 600; }
        .section { margin-bottom: 18px; }
        .section-title { font-size: 11px; color: #888; margin-bottom: 8px; text-transform: uppercase; }
        
        .folder-row { display: flex; align-items: center; gap: 6px; margin-bottom: 8px; }
        .folder-row input { flex: 1; background: #0f0f23; border: 1px solid #444; color: #eee; padding: 8px; border-radius: 4px; font-size: 11px; }
        
        .graph-type { background: #16213e; padding: 12px; border-radius: 6px; margin-bottom: 10px; }
        .graph-type-title { font-size: 12px; font-weight: 600; color: #eee; margin-bottom: 8px; }
        .graph-type label { display: flex; align-items: center; gap: 8px; padding: 6px 0; cursor: pointer; font-size: 12px; color: #ccc; }
        .graph-type input[type="checkbox"] { accent-color: #00d9ff; }
        .graph-type input[type="radio"] { accent-color: #00ff88; }
        
        .center-panel { position: relative; background: #0f0f23; }
        #graph-container { width: 100%; height: 100%; position: relative; }
        #graph-controls { position: absolute; top: 10px; right: 10px; background: rgba(22, 33, 62, 0.95); padding: 12px; border-radius: 8px; z-index: 100; min-width: 150px; }
        #graph-controls label { display: block; color: #888; font-size: 10px; margin: 8px 0 4px; }
        #graph-controls label:first-child { margin-top: 0; }
        #graph-controls select { width: 100%; background: #1a1a2e; color: #eee; border: 1px solid #444; padding: 6px; border-radius: 4px; font-size: 11px; }
        #zoom-controls { display: flex; gap: 4px; margin-top: 10px; }
        #zoom-controls button { flex: 1; background: #16213e; color: #00d9ff; border: none; padding: 6px; border-radius: 4px; cursor: pointer; }
        #layout-info { position: absolute; bottom: 10px; left: 10px; background: rgba(22, 33, 62, 0.9); padding: 8px 12px; border-radius: 4px; font-size: 11px; color: #888; }
        
        .node-tooltip { position: absolute; background: #16213e; border: 1px solid #00d9ff; padding: 10px; border-radius: 6px; max-width: 250px; z-index: 1000; display: none; }
        .node-tooltip-title { font-weight: 600; color: #00d9ff; margin-bottom: 6px; font-size: 12px; }
        .node-tooltip-text { font-size: 11px; color: #ccc; line-height: 1.4; }
        
        .detail-section { margin-bottom: 15px; }
        .detail-label { font-size: 10px; color: #888; text-transform: uppercase; margin-bottom: 4px; }
        .detail-value { font-size: 12px; padding: 8px; background: #16213e; border-radius: 4px; color: #ccc; }
        
        .footer { grid-column: 1 / -1; background: #16213e; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; font-size: 12px; }
        .status { color: #00ff88; }
        svg { width: 100%; height: 100%; }
        
        /* Light Theme */
        body.light-theme { background: #f5f5f5; color: #333; }
        body.light-theme .container { background: #ddd; }
        body.light-theme .panel { background: #fff; color: #333; }
        body.light-theme .panel-header { color: #0066cc; }
        body.light-theme .section-title { color: #666; }
        body.light-theme .folder-row input { background: #fff; border: 1px solid #ccc; color: #333; }
        body.light-theme .graph-type { background: #f0f0f0; }
        body.light-theme .graph-type-title { color: #333; }
        body.light-theme .graph-type label { color: #444; }
        body.light-theme .center-panel { background: #fff; }
        body.light-theme #graph-controls { background: rgba(245, 245, 245, 0.95); }
        body.light-theme #graph-controls select { background: #fff; color: #333; border: 1px solid #ccc; }
        body.light-theme #graph-controls button { background: #e0e0e0; color: #0066cc; }
        body.light-theme #layout-info { background: rgba(245, 245, 245, 0.9); color: #666; }
        body.light-theme .node-tooltip { background: #fff; border: 1px solid #0066cc; }
        body.light-theme .node-tooltip-title { color: #0066cc; }
        body.light-theme .node-tooltip-text { color: #555; }
        body.light-theme .detail-value { background: #f0f0f0; color: #444; }
        body.light-theme .footer { background: #e0e0e0; }
        body.light-theme #graph-svg line { stroke: #bbb; }
        body.light-theme #graph-svg text { fill: #666; }
        body.light-theme .status { color: #00aa55; }
        
        /* Theme Toggle Button */
        .theme-toggle { background: #16213e; border: 1px solid #00d9ff; color: #00d9ff; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 11px; transition: all 0.2s; margin-right: 8px; }
        .theme-toggle:hover { background: #1a1a2e; }
        body.light-theme .theme-toggle { background: #fff; border-color: #0066cc; color: #0066cc; }
        body.light-theme .theme-toggle:hover { background: #f0f0f0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="panel left-panel">
            <div class="panel-header">X Knowledge Graph V0.3.17</div>
            
            <div class="section">
                <div class="section-title">Data Sources</div>
                
                <div class="folder-row">
                    <input type="text" id="x-folder-path" placeholder="X Export folder..." readonly>
                    <button class="btn" style="background: #16213e; color: #00d9ff; border: 1px solid #00d9ff; padding: 8px 12px;" onclick="selectXFolder()">Browse</button>
                </div>
                
                <div class="folder-row">
                    <input type="text" id="grok-folder-path" placeholder="Grok Export folder..." readonly>
                    <button class="btn" style="background: #16213e; color: #00d9ff; border: 1px solid #00d9ff; padding: 8px 12px;" onclick="selectGrokFolder()">Browse</button>
                </div>
                
                <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="parseData()">Load and Build Graph</button>
            </div>
            
            <div class="section">
                <div class="section-title">Graph Type</div>
                
                <div class="graph-type">
                    <div class="graph-type-title">Knowledge Base</div>
                    <label><input type="checkbox" id="include-tweets" checked> Tweets</label>
                    <label><input type="checkbox" id="include-likes" checked> Likes</label>
                    <label><input type="checkbox" id="include-bookmarks"> Bookmarks</label>
                </div>
                
                <div class="graph-type">
                    <div class="graph-type-title">Conversations</div>
                    <label><input type="radio" name="graph-mode" value="twitter" checked> Twitter only</label>
                    <label><input type="radio" name="graph-mode" value="grok"> Grok only</label>
                    <label><input type="radio" name="graph-mode" value="linked"> Grok <-> Twitter</label>
                </div>
            </div>
            
            <div class="section" id="stats-section" style="display: none;">
                <div class="section-title">Statistics</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    <div style="background: #16213e; padding: 12px; border-radius: 6px; text-align: center;">
                        <div id="stat-tweets" style="font-size: 20px; font-weight: 700; color: #00d9ff;">0</div>
                        <div style="font-size: 10px; color: #888;">Tweets</div>
                    </div>
                    <div style="background: #16213e; padding: 12px; border-radius: 6px; text-align: center;">
                        <div id="stat-actions" style="font-size: 20px; font-weight: 700; color: #e94560;">0</div>
                        <div style="font-size: 10px; color: #888;">Actions</div>
                    </div>
                    <div style="background: #16213e; padding: 12px; border-radius: 6px; text-align: center;">
                        <div id="stat-topics" style="font-size: 20px; font-weight: 700; color: #00ff88;">0</div>
                        <div style="font-size: 10px; color: #888;">Topics</div>
                    </div>
                    <div style="background: #16213e; padding: 12px; border-radius: 6px; text-align: center;">
                        <div id="stat-connections" style="font-size: 20px; font-weight: 700; color: #9b59b6;">0</div>
                        <div style="font-size: 10px; color: #888;">Connections</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="center-panel">
            <div id="graph-container">
                <div class="node-tooltip" id="node-tooltip">
                    <div class="node-tooltip-title"></div>
                    <div class="node-tooltip-text"></div>
                </div>
                
                <div id="graph-controls">
                    <label>Layout</label>
                    <select id="layout-select">
                        <option value="force">Force</option>
                        <option value="hierarchical">Hierarchy</option>
                        <option value="circular">Circle</option>
                        <option value="radial">Radial</option>
                        <option value="grid">Grid</option>
                    </select>
                    
                    <label>Show</label>
                    <select id="node-filter">
                        <option value="all">All</option>
                        <option value="topic">Topics</option>
                        <option value="action">Actions</option>
                        <option value="tweet">Tweets</option>
                    </select>
                    
                    <label>Sort</label>
                    <select id="sort-select">
                        <option value="default">Default</option>
                        <option value="alpha">A-Z</option>
                    </select>
                    
                    <div id="zoom-controls">
                        <button onclick="zoomIn()">+</button>
                        <button onclick="zoomOut()">-</button>
                        <button onclick="zoomReset()">O</button>
                    </div>
                </div>
                
                <div id="layout-info">Click Browse to select a folder</div>
                <svg id="graph-svg"></svg>
            </div>
        </div>
        
        <div class="panel right-panel">
            <div class="panel-header">Details</div>
            <div id="details-content">
                <p style="color: #666; font-size: 12px;">Select a node</p>
            </div>
            <div id="node-details" style="display: none;">
                <div class="detail-section">
                    <div class="detail-label">Type</div>
                    <div class="detail-value" id="detail-type">-</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">Label</div>
                    <div class="detail-value" id="detail-label">-</div>
                </div>
                <div class="detail-section" id="detail-text-section">
                    <div class="detail-label">Content</div>
                    <div class="detail-value" id="detail-text" style="max-height: 100px; overflow-y: auto;">-</div>
                </div>
                <div class="detail-section" id="detail-topic-section">
                    <div class="detail-label">Topic</div>
                    <div class="detail-value" id="detail-topic">-</div>
                </div>
                <div class="detail-section" id="detail-priority-section">
                    <div class="detail-label">Priority</div>
                    <div class="detail-value" id="detail-priority">-</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">Connections</div>
                    <div class="detail-value" id="detail-connections">-</div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <span id="status">Ready</span>
            <div>
                <button class="theme-toggle" onclick="toggleTheme()">‚òÄÔ∏è Light</button>
                <button class="btn" style="background: #16213e; padding: 6px 12px;" onclick="showHelp()">Help</button>
                <button class="btn" style="background: #16213e; padding: 6px 12px;" onclick="clearAll()">Clear</button>
            </div>
        </div>
    </div>
    
    <script>
    let graphData = {nodes: [], edges: []};
    let selectedNodeId = null;
    let currentLayout = 'force';
    let zoomLevel = 1;
    let selectingFolder = null;
    
    const layouts = {
        force: function(nodes, edges, w, h) {
            const pos = {};
            const pad = 60;
            nodes.forEach((n, i) => { pos[n.id] = {x: pad + Math.random() * (w - pad*2), y: pad + Math.random() * (h - pad*2)}; });
            for (let iter = 0; iter < 80; iter++) {
                nodes.forEach(n1 => { nodes.forEach(n2 => {
                    if (n1.id === n2.id) return;
                    let dx = pos[n1.id].x - pos[n2.id].x;
                    let dy = pos[n1.id].y - pos[n2.id].y;
                    let dist = Math.sqrt(dx*dx + dy*dy) || 1;
                    let f = 3000 / (dist * dist);
                    pos[n1.id].x += (dx/dist) * f; pos[n1.id].y += (dy/dist) * f;
                });});
                edges.forEach(e => {
                    if (pos[e.source] && pos[e.target]) {
                        let dx = pos[e.target].x - pos[e.source].x;
                        let dy = pos[e.target].y - pos[e.source].y;
                        let dist = Math.sqrt(dx*dx + dy*dy) || 1;
                        let f = (dist - 80) * 0.02;
                        pos[e.source].x += (dx/dist) * f; pos[e.source].y += (dy/dist) * f;
                        pos[e.target].x -= (dx/dist) * f; pos[e.target].y -= (dy/dist) * f;
                    }
                });
                let cx = w/2, cy = h/2;
                nodes.forEach(n => { pos[n.id].x += (cx - pos[n.id].x) * 0.02; pos[n.id].y += (cy - pos[n.id].y) * 0.02; });
            }
            return pos;
        },
        hierarchical: function(nodes, edges, w, h) {
            const pos = {};
            const lev = {topic: 0, action: 1, tweet: 2, user: 3};
            const levels = {};
            nodes.forEach(n => { let l = lev[n.type] || 2; if (!levels[l]) levels[l] = []; levels[l].push(n.id); });
            let lkeys = Object.keys(levels);
            let lh = (h - 120) / (lkeys.length - 1 || 1);
            lkeys.forEach((l, i) => {
                let y = 60 + i * lh;
                let ns = levels[l];
                let sp = (w - 120) / (ns.length + 1);
                ns.forEach((nid, j) => { pos[nid] = {x: 60 + sp * (j+1), y: y}; });
            });
            return pos;
        },
        circular: function(nodes, edges, w, h) {
            const pos = {};
            const cx = w/2, cy = h/2, r = Math.min(w, h) / 3;
            nodes.forEach((n, i) => { let a = (i / nodes.length) * Math.PI * 2 - Math.PI/2; pos[n.id] = {x: cx + r * Math.cos(a), y: cy + r * Math.sin(a)}; });
            return pos;
        },
        radial: function(nodes, edges, w, h) {
            const pos = {};
            const cx = w/2, cy = h/2;
            const topics = nodes.filter(n => n.type === 'topic');
            const tr = Math.min(w, h) / 5;
            topics.forEach((t, i) => { let a = (i / topics.length) * Math.PI * 2 - Math.PI/2; pos[t.id] = {x: cx + tr * Math.cos(a), y: cy + tr * Math.sin(a)}; });
            const others = nodes.filter(n => !pos[n.id]);
            const or = Math.min(w, h) / 2.5;
            others.forEach((n, i) => { let a = (i / others.length) * Math.PI * 2; pos[n.id] = {x: cx + or * Math.cos(a), y: cy + or * Math.sin(a)}; });
            return pos;
        },
        grid: function(nodes, edges, w, h) {
            const pos = {};
            const pad = 60, c = Math.ceil(Math.sqrt(nodes.length));
            const cw = (w - pad*2) / c, ch = (h - pad*2) / Math.ceil(nodes.length/c);
            nodes.forEach((n, i) => { let r = Math.floor(i/c), col = i % c; pos[n.id] = {x: pad + col * cw + cw/2, y: pad + r * ch + ch/2}; });
            return pos;
        }
    };
    
    // Native folder picker via API
    async function selectXFolder() {
        selectingFolder = 'x';
        document.getElementById('status').textContent = 'Opening folder picker...';
        try {
            let response = await fetch('/api/select-folder', { method: 'POST' });
            let result = await response.json();
            if (result.status === 'started') {
                pollForFolder();
            }
        } catch (e) {
            alert('Error opening folder picker: ' + e.message);
            document.getElementById('status').textContent = 'Ready';
        }
    }
    
    async function selectGrokFolder() {
        selectingFolder = 'grok';
        document.getElementById('status').textContent = 'Opening folder picker...';
        try {
            let response = await fetch('/api/select-folder', { method: 'POST' });
            let result = await response.json();
            if (result.status === 'started') {
                pollForFolder();
            }
        } catch (e) {
            alert('Error opening folder picker: ' + e.message);
            document.getElementById('status').textContent = 'Ready';
        }
    }
    
    async function pollForFolder() {
        for (let i = 0; i < 100; i++) {
            await new Promise(r => setTimeout(r, 100));
            try {
                let response = await fetch('/api/get-selected-folder');
                let result = await response.json();
                if (result.status === 'done') {
                    if (result.path) {
                        if (selectingFolder === 'x') {
                            document.getElementById('x-folder-path').value = result.path;
                        } else {
                            document.getElementById('grok-folder-path').value = result.path;
                        }
                        document.getElementById('status').textContent = 'Folder selected: ' + result.path.split('/').pop();
                    } else {
                        document.getElementById('status').textContent = 'No folder selected';
                    }
                    return;
                }
            } catch (e) {
                // Continue polling
            }
        }
        document.getElementById('status').textContent = 'Selection cancelled';
    }
    
    function showHelp() {
        alert('HOW TO GET YOUR DATA:\\n\\nX (Twitter):\\n1. https://twitter.com/settings/download-your-data\\n2. Request archive\\n3. Wait for email\\n4. Download ZIP\\n5. Extract folder\\n\\nGrok:\\n1. Open Grok conversation\\n2. Menu -> Export\\n3. Save to folder');
    }
    
    async function parseData() {
        let xPath = document.getElementById('x-folder-path').value.trim();
        let grokPath = document.getElementById('grok-folder-path').value.trim();
        
        if (!xPath && !grokPath) {
            alert('Please click Browse to select a folder');
            return;
        }
        
        document.getElementById('status').textContent = 'Loading...';
        
        try {
            let response = await fetch('/api/parse-export', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    x_path: xPath,
                    grok_path: grokPath,
                    include_tweets: document.getElementById('include-tweets').checked,
                    include_likes: document.getElementById('include-likes').checked,
                    include_bookmarks: document.getElementById('include-bookmarks').checked,
                    graph_mode: document.querySelector('input[name="graph-mode"]:checked').value
                })
            });
            
            let data = await response.json();
            
            if (data.error) throw new Error(data.error);
            
            graphData = {nodes: data.graph.nodes || [], edges: data.graph.edges || []};
            
            document.getElementById('stats-section').style.display = 'block';
            document.getElementById('stat-tweets').textContent = data.stats ? data.stats.total_tweets : 0;
            document.getElementById('stat-actions').textContent = data.stats ? data.stats.total_actions : 0;
            document.getElementById('stat-topics').textContent = data.stats ? data.stats.topics_count : 0;
            document.getElementById('stat-connections').textContent = graphData.edges.length;
            
            renderGraph();
            document.getElementById('status').textContent = 'Graph loaded!';
            
        } catch (e) {
            document.getElementById('status').textContent = 'Error: ' + e.message;
            alert('Error: ' + e.message);
        }
    }
    
    function renderGraph() {
        const svg = document.getElementById('graph-svg');
        const c = document.getElementById('graph-container');
        const w = c.clientWidth, h = c.clientHeight;
        svg.innerHTML = '';
        
        if (!graphData.nodes || graphData.nodes.length === 0) {
            svg.innerHTML = '<text x="50%" y="50%" text-anchor="middle" fill="#666">No data - Click Browse to select a folder</text>';
            document.getElementById('layout-info').textContent = 'No data';
            return;
        }
        
        const colors = {tweet: '#3498db', action: '#e94560', topic: '#00d9ff', user: '#9b59b6'};
        const sizes = {tweet: 10, action: 8, topic: 25, user: 12};
        
        const filter = document.getElementById('node-filter').value;
        let nodes = filter === 'all' ? graphData.nodes : graphData.nodes.filter(n => n.type === filter);
        let nodeIds = new Set(nodes.map(n => n.id));
        let edges = graphData.edges.filter(e => nodeIds.has(e.source) && nodeIds.has(e.target));
        
        const sort = document.getElementById('sort-select').value;
        if (sort === 'alpha') nodes.sort((a, b) => (a.label || '').localeCompare(b.label || ''));
        
        let pos = layouts[currentLayout](nodes, edges, w, h);
        
        edges.forEach(e => {
            if (pos[e.source] && pos[e.target]) {
                let line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', pos[e.source].x);
                line.setAttribute('y1', pos[e.source].y);
                line.setAttribute('x2', pos[e.target].x);
                line.setAttribute('y2', pos[e.target].y);
                line.setAttribute('stroke', '#444');
                line.setAttribute('stroke-width', '1');
                svg.appendChild(line);
            }
        });
        
        nodes.forEach(n => {
            if (!pos[n.id]) return;
            let p = pos[n.id];
            let g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            g.setAttribute('data-id', n.id);
            
            let c = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            c.setAttribute('cx', p.x);
            c.setAttribute('cy', p.y);
            c.setAttribute('r', sizes[n.type] || 10);
            c.setAttribute('fill', colors[n.type] || '#666');
            c.setAttribute('stroke', selectedNodeId === n.id ? '#00ff88' : '#fff');
            c.setAttribute('stroke-width', selectedNodeId === n.id ? 3 : 2);
            c.style.cursor = 'pointer';
            
            c.onclick = function() { handleNodeClick(n); };
            c.onmouseenter = function() { c.setAttribute('stroke', '#00d9ff'); c.setAttribute('stroke-width', 3); showTooltip(n, p.x, p.y); };
            c.onmouseleave = function() { c.setAttribute('stroke', selectedNodeId === n.id ? '#00ff88' : '#fff'); c.setAttribute('stroke-width', selectedNodeId === n.id ? 3 : 2); hideTooltip(); };
            
            let t = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            t.setAttribute('x', p.x);
            t.setAttribute('y', p.y + (sizes[n.type] || 10) + 12);
            t.setAttribute('text-anchor', 'middle');
            t.setAttribute('fill', '#888');
            t.setAttribute('font-size', '9');
            t.textContent = n.label ? n.label.substring(0, 12) : n.type;
            
            g.appendChild(c);
            g.appendChild(t);
            svg.appendChild(g);
        });
        
        applyZoom();
        document.getElementById('layout-info').textContent = nodes.length + ' nodes - ' + edges.length + ' edges';
    }
    
    function handleNodeClick(node) {
        selectedNodeId = node.id;
        document.querySelectorAll('.node circle').forEach(c => {
            c.setAttribute('stroke', c.getAttribute('data-id') === node.id ? '#00ff88' : '#fff');
            c.setAttribute('stroke-width', c.getAttribute('data-id') === node.id ? 3 : 2);
        });
        
        document.getElementById('details-content').style.display = 'none';
        document.getElementById('node-details').style.display = 'block';
        
        const tc = {tweet: '#3498db', action: '#e94560', topic: '#00d9ff', user: '#9b59b6'};
        document.getElementById('detail-type').innerHTML = '<span style="color:' + (tc[node.type] || '#ccc') + '">-</span> ' + node.type;
        document.getElementById('detail-label').textContent = node.label || '-';
        
        if (node.text) {
            document.getElementById('detail-text-section').style.display = 'block';
            document.getElementById('detail-text').textContent = node.text.substring(0, 300);
        } else {
            document.getElementById('detail-text-section').style.display = 'none';
        }
        
        if (node.topic) {
            document.getElementById('detail-topic-section').style.display = 'block';
            document.getElementById('detail-topic').textContent = node.topic;
        } else {
            document.getElementById('detail-topic-section').style.display = 'none';
        }
        
        if (node.priority) {
            document.getElementById('detail-priority-section').style.display = 'block';
            document.getElementById('detail-priority').textContent = node.priority;
        } else {
            document.getElementById('detail-priority-section').style.display = 'none';
        }
        
        const connections = graphData.edges.filter(e => e.source === node.id || e.target === node.id).length;
        document.getElementById('detail-connections').textContent = connections;
    }
    
    function showTooltip(n, x, y) {
        const tt = document.getElementById('node-tooltip');
        tt.querySelector('.node-tooltip-title').textContent = n.type;
        tt.querySelector('.node-tooltip-text').textContent = n.label || n.text || '-';
        tt.style.left = (x + 15) + 'px';
        tt.style.top = (y - 30) + 'px';
        tt.style.display = 'block';
    }
    function hideTooltip() { document.getElementById('node-tooltip').style.display = 'none'; }
    
    function zoomIn() { zoomLevel = Math.min(zoomLevel * 1.3, 5); applyZoom(); }
    function zoomOut() { zoomLevel = Math.max(zoomLevel / 1.3, 0.2); applyZoom(); }
    function zoomReset() { zoomLevel = 1; applyZoom(); }
    function applyZoom() {
        const svg = document.getElementById('graph-svg');
        svg.style.transform = 'scale(' + zoomLevel + ')';
        svg.style.transformOrigin = 'center center';
    }
    
    document.getElementById('layout-select').addEventListener('change', function() { currentLayout = this.value; renderGraph(); });
    document.getElementById('node-filter').addEventListener('change', renderGraph);
    document.getElementById('sort-select').addEventListener('change', renderGraph);
    
    function clearAll() {
        graphData = {nodes: [], edges: []};
        selectedNodeId = null;
        document.getElementById('stats-section').style.display = 'none';
        document.getElementById('details-content').style.display = 'block';
        document.getElementById('node-details').style.display = 'none';
        document.getElementById('x-folder-path').value = '';
        document.getElementById('grok-folder-path').value = '';
        renderGraph();
        document.getElementById('status').textContent = 'Ready';
    }
    
    function toggleTheme() {
        const body = document.body;
        const btn = document.querySelector('.theme-toggle');
        if (body.classList.contains('light-theme')) {
            body.classList.remove('light-theme');
            btn.innerHTML = '‚òÄÔ∏è Light';
        } else {
            body.classList.add('light-theme');
            btn.innerHTML = 'üåô Dark';
        }
    }
    </script>
</body>
</html>
